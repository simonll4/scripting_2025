:80 {
  root * /srv
  file_server browse

  # Headers CORS para WebRTC/HLS
  header Access-Control-Allow-Origin "*"
  header Access-Control-Allow-Methods "GET, HEAD, POST, PUT, DELETE, OPTIONS, PATCH"
  header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
  header Access-Control-Max-Age "86400"

  # WebRTC WHEP específico para webcam
  handle /webrtc/whep/webcam {
    rewrite * /webcam/whep
    reverse_proxy {
      to mediamtx:8889
      # Reescribir Location header para mantener prefijo /webrtc/
      header_down Location ^/ /webrtc/
    }
  }

  # WebRTC WHIP específico para webcam
  handle /webrtc/whip/webcam {
    rewrite * /webcam/whip
    reverse_proxy {
      to mediamtx:8889
      header_down Location ^/ /webrtc/
    }
  }

  # HLS streams
  handle /hls/* {
    rewrite ^/hls(.*)$ $1
    reverse_proxy mediamtx:8888
  }

  # Recordings
  handle /recordings/* {
    root * /srv
    file_server browse
  }
}
